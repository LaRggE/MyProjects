
<html>
    <head>
        <title>Chaosas uzd 2</title>
        <style type="text/css">
            canvas {
                border: 0px solid #A0A0A0;
                background: white;
                display: block;
            }
        </style>
    </head>
    <body style="background-color:#282c34;">
    <canvas id="canvas" width="512" height="512">
    	Your browser does not support HTML5 Canvas.
    </canvas>
    <input type="checkbox" id="shape1" name="shape1" value="Bike">
    <label for="shape1" style="color:#ffffff"> shape1</label>
    <input type="text" id="shape1First" name="shape1First" value="0.5" size="1">
    <input type="text" id="shape1Second" name="shape1Second" value="0" size="1">
    <input type="text" id="shape1Third" name="shape1Third" value="0" size="1">
    <input type="text" id="shape1Forth" name="shape1Forth" value="0.5" size="1">
    <input type="text" id="shape1x" name="shape1x" value="0" size="1">
    <input type="text" id="shape1y" name="shape1y" value="0" size="1">    
    <br>

    <input type="checkbox" id="shape2" name="shape2" value="Car">
    <label for="shape2" style="color:#ffffff"> shape2</label>
    <input type="text" id="shape2First" name="shape2First" value="0" size="1">
    <input type="text" id="shape2Second" name="shape2Second" value="0.5" size="1">
    <input type="text" id="shape2Third" name="shape2Third" value="0.5" size="1">
    <input type="text" id="shape2Forth" name="shape2Forth" value="0" size="1">
    <input type="text" id="shape2x" name="shape2x" value="256" size="1">
    <input type="text" id="shape2y" name="shape2y" value="0" size="1">    
    <br>
    
    <input type="checkbox" id="shape3" name="shape3" value="Boat">
    <label for="shape3" style="color:#ffffff"> shape3</label>
    <input type="text" id="shape3First" name="shape3First" value="0.5" size="1">
    <input type="text" id="shape3Second" name="shape3Second" value="0" size="1">
    <input type="text" id="shape3Third" name="shape3Third" value="0" size="1">
    <input type="text" id="shape3Forth" name="shape3Forth" value="0.5" size="1">
    <input type="text" id="shape3x" name="shape3x" value="0" size="1">
    <input type="text" id="shape3y" name="shape3y" value="256" size="1">    
    <br>
    
    <input type="checkbox" id="shape4" name="shape4" value="Boat">
    <label for="shape4" style="color:#ffffff"> shape4</label>
    <input type="text" id="shape4First" name="shape4First" value="0.5" size="1">
    <input type="text" id="shape4Second" name="shape4Second" value="0" size="1">
    <input type="text" id="shape4Third" name="shape4Third" value="0" size="1">
    <input type="text" id="shape4Forth" name="shape4Forth" value="0.5" size="1">
    <input type="text" id="shape4x" name="shape4x" value="256" size="1">
    <input type="text" id="shape4y" name="shape4y" value="256" size="1">    
    <br>
    <label for="iteNum" style="color:#ffffff"> Iteration Num:</label>
    <input type="text" id="iteNum" name="iteNum" value="8" size="1">
    <br>
    <label for="messageToHide" style="color:#ffffff"> Message to hide:</label>
    <input type="text" id="messageToHide" name="messageToHide" 
    value=
    "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras vitae pretium felis, vitae blandit dui. Sed maximus sodales nisl non molestie. Ut volutpat fermentum arcu eget posuere. Ut dui neque, efficitur id lacus at, finibus pharetra leo. Quisque id diam vitae nibh molestie venenatis a eget risus. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse vel arcu libero. Ut dui sapien, tristique nec imperdiet at, sollicitudin non ipsum. Nulla porta eros ut enim fringilla, eget varius leo tincidunt. Aenean ut finibus arcu,
    in pellentesque risus. Quisque eu cursus urna. Ut sed sagittis leo.  Nam gravida nunc a dui consectetur viverra. Morbi pulvinar, lectus quis lacinia vehicula, eros tortor accumsan elit, vitae vehicula orci diam at lectus. Vivamus mattis dolor magna, eu dictum mi vestibulum dictum. Sed sodales sapien nunc, ut pulvinar elit vulputate ut. Nunc vestibulum auctor odio non efficitur. Vivamus pretium, tortor eu viverra tristique, enim nulla egestas lorem, et bibendum libero ipsum at elit. Phasellus aliquet mi at felis sodales efficitur. Proin pretium tellus elementum quam semper auctor. Ut sollicitudin ornare
    tincidunt. Praesent at velit non lacus mattis dictum vitae at lacus. Phasellus mattis est non fringilla lacinia. Sed ullamcorper sem in dui imperdiet commodo. Maecenas sed ipsum vitae libero lacinia euismod non et dolor. Vivamus et ultricies nisl. Aenean vitae sapien augue. Nunc luctus tellus diam, quis accumsan felis malesuada ac.  Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec malesuada eros nulla, eu varius neque aliquet quis. Integer nec dolor tincidunt, convallis felis vitae, elementum arcu. Phasellus vel auctor lorem. Pellentesque id ex nisl.
    "
    size="31">
    <br>
    
    <button onclick="drawAllShapes()">Draw</button>>
    <button onclick="encodeMessage()">Encode</button>>
    <button onclick="decodeMessage()">Decode</button>>
    <br>
    <p id="decodedMessage" style="color:#ffffff"></p>
    <script>
        var canvas;
        var ctx;
        var shapeTransformations = [[false, 0, 0, 0, 0, 0, 0], [false, 0, 0, 0, 0, 0, 0], [false, 0, 0, 0, 0, 0, 0], [false, 0, 0, 0, 0, 0, 0]]
        var inter = 5;
        var transNum = 0
        var binaryString = ""
        //var screenInformation

        init();
        function init(){
            canvas = document.getElementById('canvas');
            if (canvas.getContext) {
                ctx = canvas.getContext("2d");
            }
            //ctx.transform(0.5, 0, 0, 0.5, 0, 0)
            //drawShape()
        }
        function drawShape(){
            ctx.beginPath()
            // L shape
            ctx.moveTo(0, 0)
            ctx.lineTo(0, 512)
            ctx.lineTo(512, 512)
            ctx.lineTo(512, 450)
            ctx.lineTo(150, 450)
            ctx.lineTo(150, 0)
            // â–¡ shape
            // ctx.moveTo(0, 0)
            // ctx.lineTo(0, 512)
            // ctx.lineTo(512, 512)
            // ctx.lineTo(512, 0)
            ctx.fillStyle = "#000000"
            ctx.fill()
        }
        function clearCanvas(){
            ctx.clearRect(0, 0, 512, 512)
            ctx.beginPath()
            ctx.rect(0, 0, 512, 512)
            ctx.fillStyle = "#ffffff"
            ctx.fill()
        }
        function getTransformationData(){
            if(shape1.checked){
                shapeTransformations[0][0] = true
                shapeTransformations[0][1] = parseFloat(shape1First.value)
                shapeTransformations[0][2] = parseFloat(shape1Second.value)
                shapeTransformations[0][3] = parseFloat(shape1Third.value)
                shapeTransformations[0][4] = parseFloat(shape1Forth.value)
                shapeTransformations[0][5] = parseFloat(shape1x.value)
                shapeTransformations[0][6] = parseFloat(shape1y.value)
            }
            else shapeTransformations[0][0] = false
            if(shape2.checked){
                shapeTransformations[1][0] = true
                shapeTransformations[1][1] = parseFloat(shape2First.value)
                shapeTransformations[1][2] = parseFloat(shape2Second.value)
                shapeTransformations[1][3] = parseFloat(shape2Third.value)
                shapeTransformations[1][4] = parseFloat(shape2Forth.value)
                shapeTransformations[1][5] = parseFloat(shape2x.value)
                shapeTransformations[1][6] = parseFloat(shape2y.value)
            }
            else shapeTransformations[1][0] = false
            if(shape3.checked){
                shapeTransformations[2][0] = true
                shapeTransformations[2][1] = parseFloat(shape3First.value)
                shapeTransformations[2][2] = parseFloat(shape3Second.value)
                shapeTransformations[2][3] = parseFloat(shape3Third.value)
                shapeTransformations[2][4] = parseFloat(shape3Forth.value)
                shapeTransformations[2][5] = parseFloat(shape3x.value)
                shapeTransformations[2][6] = parseFloat(shape3y.value)
            }
            else shapeTransformations[2][0] = false
            if(shape4.checked){
                shapeTransformations[3][0] = true
                shapeTransformations[3][1] = parseFloat(shape4First.value)
                shapeTransformations[3][2] = parseFloat(shape4Second.value)
                shapeTransformations[3][3] = parseFloat(shape4Third.value)
                shapeTransformations[3][4] = parseFloat(shape4Forth.value)
                shapeTransformations[3][5] = parseFloat(shape4x.value)
                shapeTransformations[3][6] = parseFloat(shape4y.value)
            }
            else shapeTransformations[3][0] = false
            inter = parseInt(iteNum.value)
        }
        function drawAllShapes(){
            getTransformationData();
            console.log(shapeTransformations)
            clearCanvas()
            transNum = 0
            for(let i = 0; i < 4; i++){
                if(shapeTransformations[i][0])
                    transNum++;
            }
            //console.log("begin")
            ctx.save()
            drawF(inter)
            ctx.restore()
            //console.log("DONE")
            // console.log("beginCode")
            // binaryToMessage(messageToBinary())
            // console.log("DONECODE")
            
        }
        function transformIfChecked(num){
            if(shapeTransformations[num][0]){
                ctx.transform(shapeTransformations[num][1],
                              shapeTransformations[num][2],
                              shapeTransformations[num][3],
                              shapeTransformations[num][4],
                              shapeTransformations[num][5],
                              shapeTransformations[num][6]);
                //console.log(num)
            }
            // console.log(shapeTransformations[num][1],
            //                   shapeTransformations[num][2],
            //                   shapeTransformations[num][3],
            //                   shapeTransformations[num][4],
            //                   shapeTransformations[num][5],
            //                   shapeTransformations[num][6]);
        }
        function drawF(step) {
		if (step > 0) {
			step = step-1; 
            let tn = transNum - 1 
            for(let i = 0; i < tn;i++){
                ctx.save();
            }
    			



			// if(step == inter - 1){
			// 	ctx.fillStyle = "#CA9CA9"
			// }
			
            //ctx.transform(0, -0.5, -0.5, 0, 256, 512);  
			transformIfChecked(0)
			drawF(step); 
            if(shapeTransformations[0][0] && tn > 0){
                ctx.restore();
                tn--;
            }
			
			
			// if(step == inter - 1){
			// 	ctx.fillStyle = "#9BD3CB";
			// }

			//ctx.transform(0.5, 0, 0, 0.5, 256, 256);  
			transformIfChecked(1)
			drawF(step); 
            if(shapeTransformations[1][0] && tn > 0){
                ctx.restore();
                tn--;
            }
			
			// if(step == inter - 1){
			// 	ctx.fillStyle = "#A87550";
			// }

			//ctx.transform(0, -0.5, 0.5, 0, 0, 256);
			transformIfChecked(2)
			drawF(step); 
            if(shapeTransformations[2][0] && tn > 0){
                ctx.restore();
                tn--;
            }
			
			// if(step == inter - 1){
			// 	ctx.fillStyle = "#2D7F9D";
			// }

            //ctx.transform(0, -0.25, -0.25, 0, 375, 125); 
			transformIfChecked(3)
			drawF(step); 
            if(shapeTransformations[3][0] && tn > 0){
                ctx.restore();
                tn--;
            }

		}
		else drawShape();    
	}
        function messageToBinary(){
            let temp = messageToHide.value
            binaryString = ""
            console.log(temp.charCodeAt(1))
            for(let i = 0; i < temp.length; i++){
                let biTemp = temp.charCodeAt(i).toString(2)
                while(biTemp.length < 8)
                    biTemp = "0" + biTemp
                binaryString += biTemp
            }
            binaryString += "00000000"
            //console.log(binaryString)
            
            return binaryString
        }
        function binaryToMessage(binary){
            let temp = ""
            for(let i = 0; i < binary.length; i += 8){
                temp += String.fromCharCode(parseInt(binary.substring(i, i+8), 2))
            }
            return temp
        }
        function encodeMessage(){
            drawAllShapes()
            let fracScreenInfo = getScreenData()
            let temp = 0
            for(let i = 0; i < 512; i++){
                for(let j = 0; j < 512; j++){
                    if(fracScreenInfo[i][j] != 255){
                        temp++
                        // ctx.beginPath()
                        // ctx.rect(i, j, 1, 1);
                        // ctx.fillStyle = "red"
                        // ctx.fill()
                        //console.log(screenInformation[i][j])
                    }
                }
            }
            console.log(temp, messageToHide.value.length * 8)
            makeNoise()
            let noisyScreenInfo = getScreenData()
            hideMessage(fracScreenInfo, noisyScreenInfo, messageToBinary())
            console.log("encodeDone")
        }
        function hideMessage(fracScreenInfo, noisyScreenInfo, message){
            let messageChar = 0
            for(let i = 0; i < 512; i++){
                for(let j = 0; j < 512; j++){
                    if(fracScreenInfo[i][j] != 255){
                        if(messageChar >= message.length){
                            return
                        }
                        
                        let color = noisyScreenInfo[i][j]
                        if(message[messageChar] == 0){
                            //console.log("miau")
                            if(color % 2 != 0){
                                if(color == 255){
                                    ctx.beginPath()
                                    ctx.rect(i, j, 1, 1)
                                    ctx.fillStyle = "rgb(254, 254, 254)"
                                    ctx.fill()
                                }
                                else{
                                    color++
                                    color = color.toString()
                                    ctx.beginPath()
                                    ctx.rect(i, j, 1, 1)
                                    ctx.fillStyle = "rgb(" + color + "," + color + "," + color + ")"
                                    ctx.fill()
                                }
                            }
                            else {
                                // ctx.beginPath()
                                // ctx.rect(i, j, 1, 1)
                                // ctx.fillStyle = "rgb(" + 255 + "," + 0 + "," + 0 + ")"
                                // ctx.fill()
                            }
                        }
                        else{
                            
                            if(color % 2 == 0){
                                color++
                                color = color.toString()
                                ctx.beginPath()
                                ctx.rect(i, j, 1, 1)
                                ctx.fillStyle = "rgb(" + color + "," + color + "," + color + ")"
                                ctx.fill()
                            }
                            else {
                                // ctx.beginPath()
                                // ctx.rect(i, j, 1, 1)
                                // ctx.fillStyle = "rgb(" + 255 + "," + 0 + "," + 0 + ")"
                                // ctx.fill()
                            }
                        }
                        messageChar++
                    }
                }
            }
        }
        function decodeMessage(){
            let noisyScreenInfo = getScreenData()
            let img = getScreenImage()
            drawAllShapes()
            let fracScreenInfo = getScreenData()
            let message = readHiddenMessage(fracScreenInfo, noisyScreenInfo)
            //console.log(message)
            putScreenImage(img)
            document.getElementById("decodedMessage").innerHTML = message

        } 
        function readHiddenMessage(fracScreenInfo, noisyScreenInfo){
            let message = ""
            let tempBinary = ""
            for(let i = 0; i < 512; i++){
                for(let j = 0; j < 512; j++){
                    if(fracScreenInfo[i][j] != 255){
                        //console.log("help")
                        let color = noisyScreenInfo[i][j]
                        if(color % 2 == 0){
                            tempBinary += "0"
                        }
                        else{
                            tempBinary += "1"
                        }
                        if(tempBinary.length == 8){
                            //console.log(tempBinary)
                            if(tempBinary == "00000000"){
                                return message
                            }
                            message += binaryToMessage(tempBinary)
                            tempBinary = ""
                        }
                    }
                }
            }

        }
        function getScreenData(){
            let screenInformation = new Array(512)
            for(let i = 0; i < screenInformation.length; i++){
                screenInformation[i] = new Array(512)
            }

            var imgd = ctx.getImageData(0, 0, 512, 512);
            var pix = imgd.data;

            let x = -1
            for(let i = 0; i < 262144; i += 512){
                // console.log(heightPlane * widthPlane)
                let y = 0
                x += 1        
                for(let j  = 0; j < (512 * 4); j += 4){
                    screenInformation[y][x] = pix[(i * 4 + j)]
                    //console.log(pix[(i * 4 + j )], pix[(i * 4 + j + 1)], pix[(i * 4 + j + 2)], pix[(i * 4 + j + 3)])
                    y += 1
                }
            }
            return screenInformation
        }
        function getScreenImage(){
            return ctx.getImageData(0, 0, 512, 512);
        }
        function putScreenImage(img){
            ctx.putImageData(img, 0, 0);
        }
        function makeNoise(){
            for(let i = 0; i < 512; i++){
                for(let j = 0; j < 512; j++){
                    let randomColor = getRandomInt(0, 255).toString()
                    ctx.beginPath()
                    ctx.rect(i, j, 1, 1)
                    ctx.fillStyle = "rgb(" + randomColor + "," + randomColor + "," + randomColor + ")"
                    ctx.fill()

                    // ctx.beginPath()
                    // ctx.rect(i, j, 1, 1)
                    // ctx.fillStyle = "rgb(0, 0, 0)"
                    // ctx.fill()
                }
            }
        }
        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        /*
        Pseudo kodas:
        inputs = getInputs();
        itNum = getIterationNumber();
        
        fractal = createFractal(itNum, inputs)
        noise = makeNoise(fractal);

        message = getMessage();
        hideMessage(message, fractal, noise){
            k = 0
            for(i = 0; i < screenSizeX; i++){
                for(j = 0; j < screenSizeX; j++){
                    if(fractal[i][j] == true){
                        color = noise[i][j]
                        if(message[k] == 0)
                            if(color %2 != 0)
                                color ++;
                        elseif(color %2 == 0)
                                color++;
                        }
                    }
                    k++
                }
            }
        }
        inputs = getInputs();
        itNum = getIterationNumber();
        fractal = createFractal(itNum, inputs)

        decodedMessage = decode(fractal, noise)
        */
    </script>
</body>
</html>
